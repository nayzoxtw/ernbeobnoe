var __webpack_modules__={51:function(e,t,s){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),(new(o(s(898)).default)).startGame()},898:function(e,t,s){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=o(s(867));importScripts("./stockfish.js"),t.default=class{options;engine;isSolving;fenSolveQueue=[];lastFen;engineEvaluation;lastBestMove;constructor(e=n.default){this.options=e,this.options=e,this.isSolving=!1,this.fenSolveQueue=[],this.lastFen="",this.engineEvaluation=0,this.lastBestMove="",this.engine=STOCKFISH(),this.engine.onmessage=e=>this.engineHandler(e),this.populateSettings(),this.registerEventListeners()}startGame(){return this.solveForBestPosition(this.options.defaultFen),!0}solveForBestPosition(e){if(!this.options.enabled)return!1;this.lastFen=e,this.engineEvaluation=0,this.isSolving=!0,chrome.storage.local.set({isSolving:!0});const t=this.options.maxSolveTime,s=this.options.maxDepth;return this.engine.postMessage(`position fen ${e} moves`),this.engine.postMessage(`go movetime ${t} depth ${s}`),!0}getBestMoveFromInfoCommand(e){const t=e.split(" "),s=t.indexOf("pv");return-1===s?"":t.slice(s+1).join(" ").split(" ")[0]}getBestMoveFromBestMoveCommand(e){if(chrome.storage.local.set({isSolving:!1}),this.isSolving=!1,this.fenSolveQueue.length){const e=this.fenSolveQueue.shift();this.solveForBestPosition(e)}return e}updateUIforBestMove(e,t){chrome.storage.local.set({solver_result:{best_move:e,fen:this.lastFen,evaluation:this.engineEvaluation,depth:t}})}engineHandler(e){console.log("engineHandler: ",e);let t=e.split(" "),s=t[0],o=t[1],n=t[2];switch(s){case"bestmove":o=this.getBestMoveFromBestMoveCommand(o);break;case"info":o=this.getBestMoveFromInfoCommand(e)}o||(o=this.lastBestMove),this.lastBestMove=o,this.updateUIforBestMove(o,n)}registerEventListeners(){chrome.storage.onChanged.addListener((e=>{const{enabled:t,isSolving:s}=e;t&&!1===t.newValue&&this.engine.postMessage("stop"),s&&(this.isSolving=s.newValue)})),chrome.runtime.onMessage.addListener((({type:e,fen_string:t})=>{switch(e){case"startSolve":if(this.engine.postMessage("stop"),this.isSolving){this.fenSolveQueue.push(t);break}this.solveForBestPosition(t);break;case"newGame":case"stopSolve":this.engine.postMessage("stop"),this.engine.postMessage("ucinewgame")}}))}populateSettings(){chrome.storage.local.get("engineColor",(e=>{const t=e?.engineColor??this.options.engineColor;chrome.storage.local.set({engineColor:t})})),chrome.storage.local.get(["enabled"],(e=>{const t=e?.enabled??this.options.enabled;chrome.storage.local.set({enabled:t})})),chrome.storage.local.get(["maxDepth"],(e=>{const t=e?.enabled??this.options.maxDepth;chrome.storage.local.set({maxDepth:t})})),chrome.storage.local.get(["maxSolveTime"],(e=>{const t=e?.enabled??this.options.maxSolveTime;chrome.storage.local.set({maxSolveTime:t})})),chrome.storage.local.get(["defaultFen"],(e=>{const t=e?.enabled??this.options.defaultFen;chrome.storage.local.set({defaultFen:t})}))}populateDefaults(){return{...n.default,...this.options}}}},867:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={enabled:!0,engineColor:"#699642",maxDepth:25,maxSolveTime:8e3,defaultFen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var s=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(s.exports,s,s.exports,__webpack_require__),s.exports}var __webpack_exports__=__webpack_require__(51);